<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=1280" />
  <title>상황 퀴즈 - SumTech</title>

  <!-- 데스크톱 전용: 모바일 미지원 가정 -->
  <style>
    :root{
      /* 베이스 팔레트(스타일 변수들이 의존) */
      --white:#ffffff; --text-dark:#0f172a; --dark-gray:#475569; --gray:#e5e7eb;
      --light-gray:#f1f5f9; --accent-teal:#0095ff; --light-teal:#62c5ff;
    }

    /* Quiz Page Styles */
    .quiz-section { padding:60px 0 80px; background:var(--light-gray); }
    .quiz-start-screen { max-width:800px; margin:0 auto; }
    .quiz-intro { background:var(--white); border-radius:20px; padding:4rem 3rem; text-align:center; }
    .quiz-icon { font-size:5rem; color:var(--accent-teal); margin-bottom:2rem; }
    .quiz-intro h2 { font-size:2.5rem; font-weight:800; color:var(--text-dark); margin-bottom:1rem; }
    .quiz-intro > p { font-size:1.2rem; color:var(--dark-gray); margin-bottom:3rem; }
    .quiz-info-grid { display:grid; grid-template-columns:repeat(3,1fr); gap:2rem; margin-bottom:3rem; }
    .quiz-info-card { text-align:center; padding:2rem; background:var(--light-gray); border-radius:12px; }
    .quiz-info-card i { font-size:2.5rem; color:var(--accent-teal); margin-bottom:1rem; }
    .quiz-info-card h3 { font-size:1.2rem; font-weight:700; color:var(--text-dark); margin-bottom:.5rem; }
    .quiz-info-card p { color:var(--dark-gray); font-size:.95rem; }
    .btn-large { padding:1.2rem 3rem; font-size:1.2rem; }

    /* Topic Selection */
    .topic-select-container { margin:2rem 0; text-align:center; }
    .topic-label { display:block; font-size:1.1rem; font-weight:600; color:var(--text-dark); margin-bottom:1rem; }
    .topic-select {
      width:100%; max-width:500px; padding:1rem 1.5rem; font-size:1.05rem;
      border:2px solid var(--gray); border-radius:12px; background:var(--white); color:var(--text-dark);
      cursor:pointer; transition:all .3s;
    }
    .topic-select:hover { border-color:var(--accent-teal); }
    .topic-select:focus { outline:none; border-color:var(--accent-teal); box-shadow:0 0 0 3px rgba(0,149,255,.1); }

    /* Quiz Progress Screen */
    .quiz-progress-screen { max-width:900px; margin:0 auto; }
    .quiz-progress-bar { background:var(--white); border-radius:16px; padding:1.5rem 2rem; margin-bottom:2rem; }
    .progress-info { display:flex; justify-content:space-between; margin-bottom:1rem; font-weight:600; color:var(--text-dark); }
    .progress-bar-track { height:12px; background:var(--gray); border-radius:6px; overflow:hidden; }
    .progress-bar-fill { height:100%; background:linear-gradient(90deg, var(--accent-teal), var(--light-teal)); border-radius:6px; width:0%; transition:width .3s ease; }

    .quiz-question-card { background:var(--white); border-radius:20px; padding:3rem; margin-bottom:2rem; }
    .question-category { display:inline-flex; align-items:center; gap:.5rem; background:rgba(0,149,255,.1); color:var(--accent-teal);
      padding:.5rem 1rem; border-radius:20px; font-size:.9rem; font-weight:600; margin-bottom:1.5rem; }
    .question-text { font-size:1.8rem; font-weight:700; color:var(--text-dark); margin-bottom:1.5rem; line-height:1.4; }
    .question-scenario { background:var(--light-gray); border-left:4px solid var(--accent-teal); padding:1.5rem; border-radius:8px;
      margin-bottom:2rem; font-size:1.1rem; line-height:1.8; color:var(--text-dark); }

    .quiz-options { display:flex; flex-direction:column; gap:1rem; margin-bottom:2rem; }
    .quiz-option {
      background:var(--light-gray); border:2px solid var(--gray); border-radius:12px; padding:1.5rem; cursor:pointer; transition:all .3s;
      display:flex; align-items:center; gap:1rem;
    }
    .quiz-option:hover { border-color:var(--accent-teal); background:rgba(0,149,255,.05); transform:translateX(5px); }
    .quiz-option.selected { border-color:var(--accent-teal); background:rgba(0,149,255,.1); }
    .quiz-option.correct { border-color:#10b981; background:rgba(16,185,129,.1); }
    .quiz-option.wrong { border-color:#ef4444; background:rgba(239,68,68,.1); }
    .quiz-option.disabled { pointer-events:none; opacity:.6; }
    .option-number {
      width:40px; height:40px; background:var(--white); border-radius:50%; display:flex; align-items:center; justify-content:center;
      font-weight:700; font-size:1.1rem; color:var(--accent-teal); flex-shrink:0;
    }
    .quiz-option.correct .option-number { background:#10b981; color:var(--white); }
    .quiz-option.wrong .option-number { background:#ef4444; color:var(--white); }
    .option-text { flex:1; font-size:1.05rem; color:var(--text-dark); line-height:1.6; }

    .quiz-buttons { display:flex; gap:1rem; justify-content:space-between; }
    .quiz-buttons .btn { flex:1; }

    /* Buttons (간단 기본 버튼 묶음) */
    .btn { display:inline-flex; align-items:center; justify-content:center; gap:.6rem; padding:.9rem 1.4rem;
      background:#111827; color:#fff; border:1px solid #0f172a; border-radius:10px; cursor:pointer; font-weight:600; }
    .btn-primary { background:#0f172a; }
    .btn-outline { background:#fff; color:#0f172a; border-color:#cbd5e1; }
    .btn-outline-small { background:#fff; color:#0f172a; border-color:#cbd5e1; padding:.6rem 1rem; border-radius:9px; }
    .btn-accent { background:var(--accent-teal); color:#001a2e; border-color:#7cc6ff; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }

    /* Answer Feedback */
    .answer-feedback { background:var(--white); border-radius:16px; padding:2rem; margin-bottom:2rem; animation:slideDown .3s ease; }
    @keyframes slideDown { from{opacity:0; transform:translateY(-20px);} to{opacity:1; transform:translateY(0);} }
    .feedback-content { display:flex; align-items:center; gap:1.5rem; }
    .feedback-icon { font-size:3rem; flex-shrink:0; }
    .feedback-icon.correct { color:#10b981; }
    .feedback-icon.wrong { color:#ef4444; }
    .feedback-content h4 { font-size:1.5rem; font-weight:700; margin-bottom:.5rem; }
    .feedback-content p { color:var(--dark-gray); line-height:1.6; }

    /* Quiz Result Screen */
    .quiz-result-screen { max-width:800px; margin:0 auto; }
    .result-container { background:var(--white); border-radius:20px; padding:4rem 3rem; }
    .result-header { text-align:center; margin-bottom:3rem; }
    .result-icon { font-size:5rem; color:var(--accent-teal); margin-bottom:1.5rem; }
    .result-header h2 { font-size:2.5rem; font-weight:800; color:var(--text-dark); margin-bottom:1rem; }
    .result-header p { font-size:1.1rem; color:var(--dark-gray); }
    .result-score-card { display:flex; align-items:center; justify-content:center; gap:4rem; margin-bottom:3rem; padding:2rem; background:var(--light-gray); border-radius:16px; }
    .score-circle { position:relative; }
    .score-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; }
    .score-number { display:block; font-size:3rem; font-weight:800; color:var(--accent-teal); }
    .score-total { font-size:1.5rem; color:var(--dark-gray); }
    .score-details { display:flex; flex-direction:column; gap:1.5rem; }
    .score-detail-item { display:flex; align-items:center; gap:1rem; font-size:1.2rem; }
    .score-detail-item i { font-size:1.5rem; }
    .result-grade { text-align:center; margin-bottom:3rem; }
    .result-grade h3 { font-size:1.5rem; font-weight:700; color:var(--text-dark); margin-bottom:1.5rem; }
    .grade-badge-large {
      display:inline-block; padding:1rem 3rem; background:linear-gradient(135deg, var(--accent-teal), var(--light-teal));
      color:var(--white); font-size:3rem; font-weight:800; border-radius:16px; margin-bottom:1rem;
    }
    .result-grade p { font-size:1.1rem; color:var(--dark-gray); }
    .result-actions { display:flex; gap:1rem; }
    .result-actions .btn { flex:1; }

    /* Quiz Review Screen */
    .quiz-review-screen { max-width:900px; margin:0 auto; }
    .review-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; background:var(--white);
      padding:1.5rem 2rem; border-radius:16px; }
    .review-header h2 { font-size:1.8rem; font-weight:700; color:var(--text-dark); display:flex; align-items:center; gap:.8rem; }
    .review-list { display:flex; flex-direction:column; gap:2rem; }
    .review-item { background:var(--white); border-radius:16px; padding:2rem; border-left:6px solid #ef4444; }
    .review-item-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem; }
    .review-item-number { font-size:1.2rem; font-weight:700; color:var(--text-dark); }
    .review-item-category { background:rgba(239,68,68,.1); color:#ef4444; padding:.4rem 1rem; border-radius:20px; font-size:.9rem; font-weight:600; }
    .review-question { font-size:1.3rem; font-weight:700; color:var(--text-dark); margin-bottom:1rem; }
    .review-scenario { background:var(--light-gray); padding:1rem; border-radius:8px; margin-bottom:1.5rem; line-height:1.6; }
    .review-answer { display:flex; flex-direction:column; gap:.8rem; margin-bottom:1rem; }
    .review-answer-item { display:flex; align-items:center; gap:.8rem; padding:1rem; border-radius:8px; background:var(--light-gray); }
    .review-answer-item.correct-answer { background:rgba(16,185,129,.1); border:2px solid #10b981; }
    .review-answer-item.wrong-answer { background:rgba(239,68,68,.1); border:2px solid #ef4444; }
    .review-answer-label { font-weight:600; font-size:.9rem; }
    .review-answer-label.correct { color:#10b981; }
    .review-answer-label.wrong { color:#ef4444; }
    .review-explanation { background:rgba(0,149,255,.05); border-left:4px solid var(--accent-teal); padding:1rem 1.5rem; border-radius:8px; }
    .review-explanation strong { color:var(--accent-teal); display:block; margin-bottom:.5rem; }

    /* 레이아웃 공용 */
    body { margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background:#fff; color:#0f172a; }
    .service-detail-hero { padding:48px 0; background:#0f172a; color:#fff; }
    .service-detail-hero .container { width:1200px; max-width:90vw; margin:0 auto; }
    .service-detail-hero h1 { margin:0 0 .4rem; font-size:36px; }
    .service-detail-hero .hero-subtitle { margin:0; color:#cbd5e1; }

    .container { width:1200px; max-width:90vw; margin:0 auto; }
    nav.navbar { background:#ffffff; border-bottom:1px solid #e5e7eb; position:sticky; top:0; z-index:10; }
    .nav-container { display:flex; align-items:center; justify-content:space-between; height:64px; width:1200px; max-width:90vw; margin:0 auto; }
    .logo-text { font-weight:800; font-size:20px; color:#0f172a; }
    .nav-menu { list-style:none; display:flex; gap:16px; margin:0; padding:0; }
    .nav-link { text-decoration:none; color:#0f172a; padding:8px 10px; border-radius:8px; }
    .nav-link.active, .nav-link:hover { background:#f1f5f9; }

    .cta-section { padding:72px 0; background:#f8fafc; }
    .cta-content { display:flex; flex-direction:column; align-items:center; gap:10px; text-align:center; }
    .footer { background:#0b1220; color:#cbd5e1; margin-top:80px; }
    .footer .container { padding:40px 0; }
    .footer-content { display:grid; grid-template-columns:2fr 1fr 1fr 1fr; gap:24px; }
    .footer a { color:#e5e7eb; text-decoration:none; }
    .footer-bottom { border-top:1px solid #1f2937; padding:16px 0; text-align:center; color:#94a3b8; }

    /* Desktop Only - No Mobile Support */
  </style>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <a href="/" style="text-decoration:none"><span class="logo-text">SumTech</span></a>
      </div>
      <ul class="nav-menu">
        <li><a class="nav-link" href="/">홈</a></li>
        <li><a class="nav-link" href="/scan/voice">통화위험체크</a></li>
        <li><a class="nav-link" href="/scan/message">메세지 위협체크</a></li>
        <li><a class="nav-link" href="/api/chat-bot">모의대화 코칭</a></li>
        <li><a class="nav-link active" href="/service4.html">상황 퀴즈</a></li>
      </ul>
    </div>
  </nav>

  <!-- Hero -->
  <section class="service-detail-hero">
    <div class="container">
      <h1>상황 퀴즈</h1>
      <p class="hero-subtitle">다양한 보이스피싱 상황을 문제로 풀며 대응력을 점검합니다</p>
    </div>
  </section>

  <!-- Quiz Section -->
  <section class="quiz-section">
    <div class="container">
      <!-- Start Screen -->
      <div class="quiz-start-screen" id="quizStartScreen">
        <div class="quiz-intro">
          <div class="quiz-icon"><i class="fas fa-question-circle"></i></div>
          <h2>보이스피싱 대응 능력 테스트</h2>
          <p>실제 보이스피싱 상황에서 어떻게 대응해야 하는지 알아보세요</p>

          <div class="quiz-info-grid">
            <div class="quiz-info-card">
              <i class="fas fa-list-ol"></i>
              <h3>총 10문제</h3>
              <p>랜덤 추출 문제</p>
            </div>
            <div class="quiz-info-card">
              <i class="fas fa-clock"></i>
              <h3>제한 시간 없음</h3>
              <p>천천히 생각하며 풀기</p>
            </div>
            <div class="quiz-info-card">
              <i class="fas fa-trophy"></i>
              <h3>점수 및 해설</h3>
              <p>상세한 피드백 제공</p>
            </div>
          </div>

          <div class="topic-select-container">
            <label class="topic-label">퀴즈 주제 선택</label>
            <select id="topicSelect" class="topic-select">
              <option value="all">🎲 전체 주제 (랜덤 10문제)</option>
              <option value="delivery">🚚 택배 스미싱 (택배)</option>
              <option value="finance">💰 금융/대출 사칭 (금융)</option>
              <option value="family">👩‍👧 가족/지인 사칭 (가족)</option>
              <option value="public">🏛️ 공공기관 사칭 (공공)</option>
              <option value="voice">📞 보이스피싱 심화 (통합)</option>
            </select>
          </div>

          <button class="btn btn-accent btn-large" id="startQuizBtn">
            <i class="fas fa-play"></i> 퀴즈 시작하기
          </button>
        </div>
      </div>

      <!-- Progress Screen -->
      <div class="quiz-progress-screen" id="quizProgressScreen" style="display:none;">
        <div class="quiz-progress-bar">
          <div class="progress-info">
            <span>문제 <span id="currentQuestionNum">1</span> / <span id="totalQuestions">10</span></span>
            <span>점수: <span id="currentScore">0</span>점</span>
          </div>
          <div class="progress-bar-track"><div class="progress-bar-fill" id="progressBarFill"></div></div>
        </div>

        <div class="quiz-question-card">
          <div class="question-category" id="questionCategory"><i class="fas fa-tag"></i><span id="questionCatText">카테고리</span></div>
          <h3 class="question-text" id="questionText">문제</h3>
          <div class="question-scenario" id="questionScenario">상황 설명(있는 경우)</div>

          <div class="quiz-options" id="quizOptions"></div>

          <div class="quiz-buttons">
            <button class="btn btn-outline" id="prevQuestionBtn" style="display:none;"><i class="fas fa-arrow-left"></i> 이전 문제</button>
            <button class="btn btn-primary" id="nextQuestionBtn" disabled>다음 문제 <i class="fas fa-arrow-right"></i></button>
            <button class="btn btn-accent" id="submitQuizBtn" style="display:none;"><i class="fas fa-check"></i> 제출하기</button>
          </div>
        </div>

        <div class="answer-feedback" id="answerFeedback" style="display:none;">
          <div class="feedback-content">
            <div class="feedback-icon" id="feedbackIcon"><i class="fas fa-check-circle"></i></div>
            <div>
              <h4 id="feedbackTitle">정답입니다!</h4>
              <p id="feedbackExplanation">올바른 대응 방법입니다.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Result Screen -->
      <div class="quiz-result-screen" id="quizResultScreen" style="display:none;">
        <div class="result-container">
          <div class="result-header">
            <div class="result-icon"><i class="fas fa-trophy"></i></div>
            <h2>퀴즈 완료!</h2>
            <p>수고하셨습니다. 결과를 확인하세요.</p>
          </div>

          <div class="result-score-card">
            <div class="score-circle">
              <svg width="200" height="200">
                <circle cx="100" cy="100" r="90" fill="none" stroke="#e5e7eb" stroke-width="12"/>
                <circle id="scoreCircle" cx="100" cy="100" r="90" fill="none" stroke="#0095ff" stroke-width="12"
                        stroke-dasharray="565.48" stroke-dashoffset="565.48"
                        transform="rotate(-90 100 100)" style="transition:stroke-dashoffset 1s ease;"/>
              </svg>
              <div class="score-text">
                <span class="score-number" id="finalScore">0</span>
                <span class="score-total">/ 100</span>
              </div>
            </div>
            <div class="score-details">
              <div class="score-detail-item"><i class="fas fa-check-circle" style="color:#10b981;"></i><span>정답: <strong id="correctCount">0</strong>개</span></div>
              <div class="score-detail-item"><i class="fas fa-times-circle" style="color:#ef4444;"></i><span>오답: <strong id="wrongCount">0</strong>개</span></div>
            </div>
          </div>

          <div class="result-grade" id="resultGrade">
            <h3>당신의 등급</h3>
            <div class="grade-badge-large" id="gradeBadge">A+</div>
            <p id="gradeComment">보이스피싱 대응 능력이 매우 우수합니다!</p>
          </div>

          <div class="result-actions">
            <button class="btn btn-accent" id="retryQuizBtn"><i class="fas fa-redo"></i> 다시 풀기</button>
            <button class="btn btn-outline" id="reviewAnswersBtn"><i class="fas fa-list"></i> 오답 확인하기</button>
          </div>
        </div>
      </div>

      <!-- Review Screen -->
      <div class="quiz-review-screen" id="quizReviewScreen" style="display:none;">
        <div class="review-header">
          <h2><i class="fas fa-clipboard-list"></i> 오답 복습</h2>
          <button class="btn btn-outline-small" id="backToResultBtn"><i class="fas fa-arrow-left"></i> 결과로 돌아가기</button>
        </div>
        <div class="review-list" id="reviewList"></div>
      </div>
    </div>
  </section>

  <!-- Tips -->
  <section class="quiz-tips-section" style="background:#fff; padding:80px 0;">
    <div class="container">
      <h2 style="text-align:center; font-size:2.5rem; font-weight:800; color:#0f172a; margin-bottom:3rem;">퀴즈 TIP</h2>
      <div class="quiz-info-grid">
        <div class="quiz-info-card">
          <i class="fas fa-lightbulb"></i>
          <h3>차분하게 생각하기</h3>
          <p>보이스피싱범은 급하게 행동하도록 유도합니다. 침착하게 대응하세요.</p>
        </div>
        <div class="quiz-info-card">
          <i class="fas fa-phone-slash"></i>
          <h3>전화 끊고 확인하기</h3>
          <p>의심되면 전화를 끊고 공식 연락처로 직접 확인하세요.</p>
        </div>
        <div class="quiz-info-card">
          <i class="fas fa-user-shield"></i>
          <h3>개인정보 보호하기</h3>
          <p>어떤 경우에도 개인정보나 금융정보를 제공하지 마세요.</p>
        </div>
        <div class="quiz-info-card">
          <i class="fas fa-flag"></i>
          <h3>신고하기</h3>
          <p>보이스피싱 의심 시 즉시 112, 1332로 신고하세요.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- CTA & Footer -->
  <section class="cta-section">
    <div class="container">
      <div class="cta-content">
        <h2>보이스피싱 대응 능력을 키우세요</h2>
        <p>정기적으로 퀴즈를 풀어보며 실전 대응 능력을 향상시키세요</p>
        <button class="btn btn-primary" onclick="window.scrollTo({top:0, behavior:'smooth'})">퀴즈 다시 풀기</button>
      </div>
    </div>
  </section>

  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3 class="footer-logo">SumTech</h3>
          <p>보이스피싱 예방을 위한 AI 기반 솔루션을 제공합니다.</p>
        </div>
        <div class="footer-section">
          <h4>서비스</h4>
          <ul>
            <li><a href="/scan/voice">통화위험체크</a></li>
            <li><a href="/scan/message">메세지 위협체크</a></li>
            <li><a href="/api/chat-bot">모의대화 코칭</a></li>
            <li><a href="/service4.html">상황 퀴즈</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>긴급 신고</h4>
          <ul>
            <li>경찰신고: 112</li>
            <li>금융감독원: 1332</li>
            <li>보이스피싱: 1588-2112</li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>법적 고지</h4>
          <ul>
            <li><a href="#">이용약관</a></li>
            <li><a href="#">개인정보처리방침</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom"><p>&copy; 2024 SumTech. All rights reserved.</p></div>
    </div>
  </footer>

  <!-- ===== 퀴즈 데이터 (파이썬 파일에서 변환하여 내장) & 스크립트 ===== -->
  <script>
  /* ✔️ 백엔드 없이 즉시 동작: 파이썬 delivery/finance/family/public/voice_quiz.py의 TITLE/QUIZ를 JSON으로 변환해 내장했습니다. */
  const QUIZ_DB = {
    "delivery": {"title":"🚚 택배 스미싱 (택배)","items":[
      {"q":"문자에 있는 ‘배송 조회’ 링크가 열리지 않아 다른 링크를 추가로 보내주겠다고 합니다. 어떻게 해야 할까요?","options":["추가 링크를 받아 바로 접속한다","문자에 포함된 링크는 모두 의심하고 택배사 공식 앱이나 사이트에서 직접 조회한다","보낸 번호로 바로 전화해 상황을 확인한다","링크를 친구에게 보내서 먼저 눌러보게 한다"],"answer":2,"explain":"스미싱 링크는 변종이 많아 어떤 형태든 의심해야 합니다. 택배 조회는 반드시 ‘공식 앱/사이트’ 또는 배송사 고객센터를 통해 확인하세요."},
      {"q":"‘반품 처리 비용 800원을 결제해야 합니다’라는 알림과 함께 결제 페이지 링크가 왔습니다. 올바른 대응은?","options":["소액이라 결제하고 넘어간다","링크를 눌러 카드 정보를 입력한다","링크를 누르지 않고 배송사 고객센터나 마이페이지에서 주문 내역을 확인한다","문자를 무시하고 기다린다"],"answer":3,"explain":"소액 결제를 유도해 카드정보/계좌정보를 빼내는 수법입니다. 링크 접속 없이 공식 경로에서 주문/반품 내역을 확인하세요."},
      {"q":"‘주소가 불명확해 배송이 보류되었습니다. 아래 링크에서 주소를 다시 입력하세요.’라고 왔습니다. 가장 안전한 방법은?","options":["링크에서 즉시 주소를 수정한다","문자를 보낸 번호로 주소를 알려준다","택배사 공식 고객센터 또는 앱에서 주문번호로 직접 조회/수정한다","그냥 무시한다"],"answer":3,"explain":"주소 재입력 요청도 전형적인 스미싱입니다. 반드시 공식 앱/사이트에서만 주소 변경을 진행하세요."},
      {"q":"‘관세 미납’ 명목으로 해외배송 물품이 보류되었다며 링크로 택배사 로그인/결제를 요구합니다. 대처는?","options":["링크로 로그인해 조회한다","관세청/택배사 공식 홈페이지나 전화로 직접 확인한다","문자에 답장해 더 자세한 안내를 요청한다","해당 링크를 북마크해둔다"],"answer":2,"explain":"관세/해외배송 관련은 관세청 또는 배송사 ‘공식 채널’로만 확인/납부하세요. 문자 링크 요구는 사기 가능성이 큽니다."},
      {"q":"‘택배 기사입니다. 분실 위험이 있어 보증금을 먼저 넣어주셔야 합니다.’라고 전화가 왔습니다. 적절한 대응은?","options":["안전상 어쩔 수 없으니 입금한다","기사님 말이니 믿고 처리한다","즉시 전화를 끊고 해당 배송사 고객센터로 사실 여부를 확인한다","주소를 다시 알려준다"],"answer":3,"explain":"보증금/선 입금 요구는 사기입니다. 전화는 끊고 반드시 공식 고객센터로 사실 여부를 확인하세요."}
    ]},
    "finance": {"title":"💰 금융/대출 사칭 (금융)","items":[
      {"q":"‘대출 금리를 1%대로 낮춰드리겠습니다. 수수료만 먼저 입금하세요.’ 라는 연락. 올바른 판단은?","options":["수수료만 내면 이득이니 진행한다","담당자 신분증 사본을 받아 진행한다","선입금/보증금 요구는 사기 의심. 거래 중단하고 공식 금융사에 직접 문의한다","조건이 좋아서 바로 신분증/통장사본을 보낸다"],"answer":3,"explain":"정상 금융사는 선입금을 요구하지 않습니다. 모든 제안은 ‘공식 채널’로 재확인하세요."},
      {"q":"‘카드 사용 이상 징후’라며 원격 앱 설치를 유도합니다. 대응은?","options":["원격 앱을 깔아 신속히 확인한다","화면 공유로 빨리 해결한다","앱 설치/화면공유 요구는 즉시 거부하고 카드사 공식 번호로 직접 확인한다","카드 비밀번호를 불러준다"],"answer":3,"explain":"원격제어/화면공유 유도는 대표적 사기 수법입니다. 공식 고객센터로만 확인하세요."},
      {"q":"낮은 한도/고금리 때문에 힘들다고 하자, ‘당일 대환 가능’이라며 개인정보/OTP 인증을 요구합니다. 맞는 대응은?","options":["빠르게 OTP를 알려준다","신분증/계좌 정보를 사진으로 보낸다","대환은 반드시 금융사 공식 앱/창구에서만 진행한다","사설 채널 링크로 접속한다"],"answer":3,"explain":"대환/대출 절차는 오직 공식 채널에서만. OTP/인증정보 공유는 절대 금지입니다."}
    ]},
    "family": {"title":"👩‍👧 가족/지인 사칭 (가족)","items":[
      {"q":"메신저로 ‘엄마 나 폰이 고장나서 급히 돈이 필요해’라며 다른 계좌로 송금을 요구. 안전한 절차는?","options":["바로 송금한다","메신저에서 신상 질문을 해서 확인한다","전화/영상통화 등 ‘본인 실물 확인’ 후에만 판단한다","요구한 계좌로 소액 먼저 보낸다"],"answer":3,"explain":"메신저 사칭은 흔합니다. 반드시 본인 확인(직접 통화/영상통화) 후 판단하세요."},
      {"q":"지인이 ‘검찰 조사 중이라 통화가 어려워’라며 문자로만 송금을 요구. 올바른 판단은?","options":["검찰이라니 바로 보낸다","문자 그대로 믿는다","전화를 끊고 해당 지인과 ‘다른 경로(기존 번호)’로 사실부터 확인한다","개인정보를 보내서 도와준다"],"answer":3,"explain":"긴급/압박은 사기 신호. 기존에 알고 있는 연락처로 재확인하세요."}
    ]},
    "public": {"title":"🏛️ 공공기관 사칭 (공공)","items":[
      {"q":"검찰/경찰을 사칭하며 ‘계좌가 범죄에 이용됐다. 안전계좌로 옮겨라’고 요구. 대응은?","options":["안전계좌로 즉시 이체한다","사건번호를 문자로 달라 한다","전화 즉시 종료 후 112/공식 대표번호로 사실 확인한다","메신저로 신분증을 받아본다"],"answer":3,"explain":"공공기관이 ‘안전계좌 이체’를 요구하는 일은 없습니다. 전화를 끊고 공식 번호로 확인하세요."},
      {"q":"국세청/건보공단을 사칭하며 ‘환급금 지급’ 링크 전송. 올바른 대응은?","options":["링크로 로그인한다","공식 홈페이지/앱에서 환급 여부를 직접 확인한다","문자에 답장해 본인확인을 진행한다","링크를 가족에게 공유한다"],"answer":2,"explain":"환급/납부 관련은 반드시 ‘공식 홈페이지/앱’에서 확인하세요. 문자 링크는 클릭 금지."}
    ]},
    "voice": {"title":"📞 보이스피싱 심화 (통합)","items":[
      {"q":"상대가 계속 ‘바로 처리해야 한다’며 시간을 압박한다. 가장 먼저 할 일은?","options":["상대가 하라는 대로 따라간다","시간을 끌며 더 많은 정보를 듣는다","전화를 끊고 심호흡/상황을 정리한 뒤, 공식 채널로 재확인한다","가까운 편의점으로 이동한다"],"answer":3,"explain":"시간 압박은 대표적 기법입니다. 통화를 종료하고 스스로 판단 시간을 확보한 뒤 공식 채널에서 확인하세요."},
      {"q":"통화 중 원격제어앱 설치/스마트폰 설정 변경을 요구. 어떻게?","options":["문제 해결을 위해 설치한다","일단 깔고 나중에 지운다","설치/변경 요구는 즉시 거절하고 통화 종료 후 공식 고객센터로 확인한다","상대 화면을 녹화한다"],"answer":3,"explain":"원격제어/설정변경 요구는 매우 위험합니다. 즉시 거절 후 공식 채널 확인이 정석입니다."}
    ]},
    "all": {"title":"🎲 전체 주제","items":[]}
  };
  // all 항목 합치기
  (function(){
    const all = [];
    for (const k of ["delivery","finance","family","public","voice"]) {
      for (const it of QUIZ_DB[k].items) all.push({...it, _cat: QUIZ_DB[k].title});
    }
    QUIZ_DB.all.items = all;
  })();
  </script>

  <script>
/* ===== 동작 스크립트 ===== */
const USE_LOCAL_DB = true;          // ✔️ 로컬 내장 DB 사용
const API_BASE = "/api/quiz";       // false로 전환 시 이 엔드포인트 사용

// 화면 엘리먼트 캐시 (id는 네가 쓰던 그대로 매핑)
const el = {
  start: document.getElementById('quizStartScreen'),
  progress: document.getElementById('quizProgressScreen'),
  result: document.getElementById('quizResultScreen'),
  review: document.getElementById('quizReviewScreen'),
  topic: document.getElementById('topicSelect'),
  startBtn: document.getElementById('startQuizBtn'),
  curNum: document.getElementById('currentQuestionNum'),
  total: document.getElementById('totalQuestions'),
  score: document.getElementById('currentScore'),
  bar: document.getElementById('progressBarFill'),
  cat: document.getElementById('questionCatText'),
  q: document.getElementById('questionText'),
  scenario: document.getElementById('questionScenario'),
  options: document.getElementById('quizOptions'),
  prev: document.getElementById('prevQuestionBtn'),
  next: document.getElementById('nextQuestionBtn'),
  submit: document.getElementById('submitQuizBtn'),
  fb: document.getElementById('answerFeedback'),
  fbIcon: document.getElementById('feedbackIcon'),
  fbTitle: document.getElementById('feedbackTitle'),
  fbExp: document.getElementById('feedbackExplanation'),
  finalScore: document.getElementById('finalScore'),
  correctCount: document.getElementById('correctCount'),
  wrongCount: document.getElementById('wrongCount'),
  scoreCircle: document.getElementById('scoreCircle'),
  gradeBadge: document.getElementById('gradeBadge'),
  gradeComment: document.getElementById('gradeComment'),
  retry: document.getElementById('retryQuizBtn'),
  reviewBtn: document.getElementById('reviewAnswersBtn'),
  backToResult: document.getElementById('backToResultBtn'),
  reviewList: document.getElementById('reviewList')
};

let state = {
  topicKey: 'all',
  bank: [],
  i: 0,
  answers: [], // {sel, correctIdx, isCorrect, q}
  score: 0
};

function showScreen(which){
  el.start.style.display = (which==='start')?'':'none';
  el.progress.style.display = (which==='progress')?'':'none';
  el.result.style.display = (which==='result')?'':'none';
  el.review.style.display = (which==='review')?'':'none';
}

function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];} return a; }

async function loadTopics(){
  if (USE_LOCAL_DB) {
    // 이미 select에 옵션이 들어있지만, 로컬 DB의 타이틀로 보정하고 싶을 때는 아래 주석 해제
    // const order = ['all','delivery','finance','family','public','voice'];
    // el.topic.innerHTML = order.map(key => {
    //   const t = key==='all' ? '🎲 전체 주제 (랜덤 10문제)' : QUIZ_DB[key].title;
    //   return `<option value="${key}">${t}</option>`;
    // }).join('');
    return;
  } else {
    const res = await fetch(`${API_BASE}/topics`);
    const topics = await res.json();
    const opts = [
      {key:'all', title:'🎲 전체 주제 (랜덤 10문제)'},
      ...topics.filter(t => t.key !== 'all')
    ];
    el.topic.innerHTML = opts.map(t => `<option value="${t.key}">${t.title}</option>`).join('');
  }
}

async function fetchQuiz(topic='all', n=10){
  if (USE_LOCAL_DB) {
    const bag = (QUIZ_DB[topic] || QUIZ_DB.all);
    const items = shuffle([...bag.items]).slice(0, n);
    return { topic, topic_title: bag.title, total: items.length, items };
  } else {
    const res = await fetch(`${API_BASE}?topic=${encodeURIComponent(topic)}&n=${n}`);
    if(!res.ok) throw new Error('퀴즈 로딩 실패');
    return res.json(); // {topic, topic_title, total, items:[{q, options, answer, explain}]}
  }
}

function renderQuestion(){
  const q = state.bank[state.i];
  el.curNum.textContent = state.i+1;
  el.total.textContent = state.bank.length;
  el.cat.textContent = q._cat || (QUIZ_DB[state.topicKey]?.title || '퀴즈');
  el.q.textContent = q.q;
  el.scenario.style.display = 'none';
  el.options.innerHTML = '';

  q.options.forEach((opt, idx)=>{
    const item = document.createElement('div');
    item.className = 'quiz-option';
    item.dataset.idx = idx+1; // 1-base
    item.innerHTML = `<div class="option-number">${idx+1}</div><div class="option-text">${opt}</div>`;
    item.onclick = ()=>selectOption(idx+1);
    el.options.appendChild(item);
  });

  el.prev.style.display = state.i>0?'':'none';
  el.next.disabled = true;
  el.submit.style.display = (state.i === state.bank.length-1)?'':'none';
  el.fb.style.display = 'none';
  el.bar.style.width = `${(state.i/state.bank.length)*100}%`;

  const prevAns = state.answers[state.i];
  if(prevAns){
    markSelection(prevAns.sel, prevAns.correctIdx);
    el.next.disabled = false;
    if(prevAns.isCorrect!==undefined){
      showFeedback(prevAns.isCorrect, prevAns.q.explain);
    }
  }
}

function markSelection(sel, correctIdx){
  [...el.options.children].forEach(div=>{
    div.classList.remove('selected','correct','wrong','disabled');
    if(Number(div.dataset.idx)===sel) div.classList.add('selected');
  });
  [...el.options.children].forEach(div=>{
    const idx = Number(div.dataset.idx);
    if(idx===correctIdx) div.classList.add('correct');
    else if(idx===sel && sel!==correctIdx) div.classList.add('wrong');
    div.classList.add('disabled');
  });
}

function showFeedback(ok, exp){
  el.fb.style.display = '';
  el.fbTitle.textContent = ok ? '정답입니다!' : '오답입니다.';
  el.fbIcon.className = 'feedback-icon ' + (ok ? 'correct' : 'wrong');
  el.fbIcon.innerHTML = `<i class="fas ${ok?'fa-check-circle':'fa-times-circle'}"></i>`;
  el.fbExp.textContent = exp || '';
}

function selectOption(sel){
  const q = state.bank[state.i];
  const correctIdx = q.answer;
  const ok = sel===correctIdx;

  markSelection(sel, correctIdx);
  showFeedback(ok, q.explain);

  state.answers[state.i] = { sel, correctIdx, isCorrect: ok, q };
  state.score = state.answers.filter(a=>a?.isCorrect).length * 10;
  el.score.textContent = state.score.toString();
  el.next.disabled = (state.i === state.bank.length-1) ? true : false;
  if(state.i === state.bank.length-1) el.submit.style.display = '';
}

function submitQuiz(){
  showScreen('result');
  const correct = state.answers.filter(a=>a?.isCorrect).length;
  const wrong = state.bank.length - correct;
  const percent = Math.round((correct/state.bank.length)*100);

  el.finalScore.textContent = String(percent);
  el.correctCount.textContent = String(correct);
  el.wrongCount.textContent = String(wrong);

  const circumference = 2*Math.PI*90;
  const offset = circumference * (1 - percent/100);
  el.scoreCircle.style.strokeDashoffset = offset.toFixed(2);

  let grade='A+', comment='보이스피싱 대응 능력이 매우 우수합니다!';
  if(percent>=80){ grade='A'; comment='대부분 상황에서 적절히 대응할 수 있어요.'; }
  if(percent<80 && percent>=60){ grade='B'; comment='조금만 더 연습하면 좋아져요.'; }
  if(percent<60){ grade='C'; comment='의심 연락은 즉시 종료하고 공식 경로로 재확인하는 습관을 들이세요.'; }
  el.gradeBadge.textContent = grade;
  el.gradeComment.textContent = comment;
}

function buildReview(){
  el.reviewList.innerHTML = '';
  state.answers.forEach((a, idx)=>{
    if(!a || a.isCorrect) return;
    const wrap = document.createElement('div');
    wrap.className = 'review-item';
    wrap.innerHTML = `
      <div class="review-item-header">
        <div class="review-item-number">문항 ${idx+1}</div>
        <div class="review-item-category">오답</div>
      </div>
      <div class="review-question">${a.q.q}</div>
      <div class="review-answer">
        <div class="review-answer-item wrong-answer"><span class="review-answer-label wrong">내 답</span> <span>${a.q.options[a.sel-1]}</span></div>
        <div class="review-answer-item correct-answer"><span class="review-answer-label correct">정답</span> <span>${a.q.options[a.correctIdx-1]}</span></div>
      </div>
      <div class="review-explanation"><strong>해설</strong>${a.q.explain||''}</div>
    `;
    el.reviewList.appendChild(wrap);
  });
}

// 이벤트
el.startBtn.onclick = async ()=>{
  state.topicKey = el.topic.value || 'all';
  const data = await fetchQuiz(state.topicKey, 10);
  state.bank = data.items.map(it => ({...it, _cat: data.topic_title || it._cat}));
  state.i = 0; state.answers = []; state.score = 0;
  el.score.textContent = '0'; el.bar.style.width = '0%';
  showScreen('progress');
  renderQuestion();
};
el.prev.onclick = ()=>{ if(state.i>0){ state.i--; renderQuestion(); } };
el.next.onclick = ()=>{ if(state.i<state.bank.length-1){ state.i++; renderQuestion(); } };
el.submit.onclick = ()=> submitQuiz();
el.retry.onclick = ()=> showScreen('start');
el.reviewBtn.onclick = ()=>{ buildReview(); showScreen('review'); };
el.backToResult.onclick = ()=> showScreen('result');

// 초기 로드
loadTopics().catch(()=>{ /* 토픽 로딩 실패 시에도 기본 셀렉트 유지 */ });
  </script>
</body>
</html>
